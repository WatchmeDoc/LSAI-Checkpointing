==== RUNNING PCCHECK FOR 1024 WITH fp32 ====
2025-05-24 16:47:50,372 - root - INFO - Experiment args: Namespace(dataset='/capstor/store/cscs/ethz/large-sc/datasets/train_data.parquet', tokenizer_name_or_path='unsloth/Mistral-Nemo-Base-2407-bnb-4bit', sequence_length=1024, batch_size=1, fused_optimizer=False, learning_rate=1e-05, lr_warmup_steps=10, training_steps=10, logging_frequency=5, profile=False, profile_step_start=10, profile_step_end=12, grad_max_norm=1, model_dtype='fp32', compile=False, seed=4, checkpoint_dir='./checkpointing/checkpoints', loss_file='./results/fp32/sl_1024/loss_trace.csv', checkpoint_freq=1, max_async=1, warmup=0, load_checkpoint=False, non_blocking=False)
2025-05-24 16:47:50,374 - root - INFO - Setting up DataLoaders...
2025-05-24 16:47:51,257 - root - INFO - Setting up Model...
Model size: 755041280, Optimizer size: 1510082852, Total size: 2265124132
BSIZE IS 2265124132
At checkpoint, bsize is 2265124132
2025-05-24 16:48:29,718 - root - INFO - Checkpointing warmup done
2025-05-24 16:48:29,719 - root - INFO - ------------------------------------------------------------Starting training!
2025-05-24 16:48:30,020 - root - INFO - Step: 1 | Loss: 11.91 | Tokens per second: 3436.61 | Training tokens per second (%): 77.54 | MFU (%): 1.43 | TFLOPs: 14.18
2025-05-24 16:48:30,036 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:48:30,037 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:48:30,159 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:48:30,160 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:48:32,834 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:48:32,835 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:48:35,472 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:48:35,472 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:48:38,132 - root - INFO - Step: 5 | Loss: 11.89 | Tokens per second: 505.12 | Training tokens per second (%): 40.14 | MFU (%): 0.21 | TFLOPs: 2.08
2025-05-24 16:48:38,148 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:48:38,150 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:48:40,797 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:48:40,799 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:48:43,506 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:48:43,508 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:48:46,194 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:48:46,196 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:48:48,928 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:48:48,929 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:48:51,609 - root - INFO - Step: 10 | Loss: 11.78 | Tokens per second: 379.98 | Training tokens per second (%): 83.77 | MFU (%): 0.16 | TFLOPs: 1.57
2025-05-24 16:48:51,625 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:48:51,626 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
PR_ADDR_DATA is 0x400800280000, PR_ADDR is 0x400800000000, PEER_CHECK_ADDR is 0x400800080000
--------------- init enqueue: 0
--------------- init enqueue: 1
Call dram.alloc, num_batches is 2, batch_size_floats is 2265124132
------------------------- is_distributed is 0, rank is 0
Parall_iter 0, Write new metadata at address 0x400800180000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 127, parall_iter is 0, num_threads is 1, last counter is 0, curr_counter is 1
Writing offset is 52080, parall_iter_offset is 0
start_pr_arr is 0x400800280000, curr_pr_arr is 0x400800280000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 2265124132, start addr is 0x400800280000!
Thread ID: 1, savenvm_thread_nd took 2583.170176 ms
Thread ID: 1, set_cpu took 0.100669 ms
Threads took 2583.561365 ms
MSYNC 9060496528 TOOK 23.321923 ms
CAS was successful! new counter is 1, is_distributed is 0
******** checkp_info saved in 0x400800180000, curr_checkpoint is 0x400800180000
0, 1
Parall_iter 1, Write new metadata at address 0x400800200000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 2, parall_iter is 1, num_threads is 1, last counter is 1, curr_counter is 2
Writing offset is 52080, parall_iter_offset is 2265137152
start_pr_arr is 0x400a1c350000, curr_pr_arr is 0x400a1c350000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 2265124132, start addr is 0x400a1c350000!
Thread ID: 2, savenvm_thread_nd took 2532.198098 ms
Thread ID: 2, set_cpu took 0.077790 ms
Threads took 2532.414124 ms
MSYNC 9060496528 TOOK 15.878393 ms
CAS was successful! new counter is 2, is_distributed is 0
******** checkp_info saved in 0x400800200000, curr_checkpoint is 0x400800200000
1, 2
Parall_iter 0, Write new metadata at address 0x400800180000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 30, parall_iter is 0, num_threads is 1, last counter is 2, curr_counter is 3
Writing offset is 52080, parall_iter_offset is 0
start_pr_arr is 0x400800280000, curr_pr_arr is 0x400800280000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 2265124132, start addr is 0x400800280000!
Thread ID: 1, savenvm_thread_nd took 2572.529968 ms
Thread ID: 1, set_cpu took 0.110749 ms
Threads took 2572.775626 ms
MSYNC 9060496528 TOOK 21.474745 ms
CAS was successful! new counter is 3, is_distributed is 0
******** checkp_info saved in 0x400800180000, curr_checkpoint is 0x400800180000
0, 3
Parall_iter 1, Write new metadata at address 0x400800200000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 35, parall_iter is 1, num_threads is 1, last counter is 3, curr_counter is 4
Writing offset is 52080, parall_iter_offset is 2265137152
start_pr_arr is 0x400a1c350000, curr_pr_arr is 0x400a1c350000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 2265124132, start addr is 0x400a1c350000!
Thread ID: 2, savenvm_thread_nd took 2539.411781 ms
Thread ID: 2, set_cpu took 0.091741 ms
Threads took 2539.641599 ms
MSYNC 9060496528 TOOK 20.006755 ms
CAS was successful! new counter is 4, is_distributed is 0
******** checkp_info saved in 0x400800200000, curr_checkpoint is 0x400800200000
1, 4
Parall_iter 0, Write new metadata at address 0x400800180000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 55, parall_iter is 0, num_threads is 1, last counter is 4, curr_counter is 5
Writing offset is 52080, parall_iter_offset is 0
start_pr_arr is 0x400800280000, curr_pr_arr is 0x400800280000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 2265124132, start addr is 0x400800280000!
Thread ID: 1, savenvm_thread_nd took 2602.940681 ms
Thread ID: 1, set_cpu took 0.071486 ms
Threads took 2603.154819 ms
MSYNC 9060496528 TOOK 20.269147 ms
CAS was successful! new counter is 5, is_distributed is 0
******** checkp_info saved in 0x400800180000, curr_checkpoint is 0x400800180000
0, 5
Parall_iter 1, Write new metadata at address 0x400800200000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 58, parall_iter is 1, num_threads is 1, last counter is 5, curr_counter is 6
Writing offset is 52080, parall_iter_offset is 2265137152
start_pr_arr is 0x400a1c350000, curr_pr_arr is 0x400a1c350000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 2265124132, start addr is 0x400a1c350000!
Thread ID: 2, savenvm_thread_nd took 2578.508580 ms
Thread ID: 2, set_cpu took 0.074334 ms
Threads took 2578.712062 ms
MSYNC 9060496528 TOOK 18.527789 ms
CAS was successful! new counter is 6, is_distributed is 0
******** checkp_info saved in 0x400800200000, curr_checkpoint is 0x400800200000
1, 6
Parall_iter 0, Write new metadata at address 0x400800180000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 61, parall_iter is 0, num_threads is 1, last counter is 6, curr_counter is 7
Writing offset is 52080, parall_iter_offset is 0
start_pr_arr is 0x400800280000, curr_pr_arr is 0x400800280000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 2265124132, start addr is 0x400800280000!
Thread ID: 1, savenvm_thread_nd took 2622.303997 ms
Thread ID: 1, set_cpu took 0.081310 ms
Threads took 2622.528118 ms
MSYNC 9060496528 TOOK 20.690415 ms
CAS was successful! new counter is 7, is_distributed is 0
******** checkp_info saved in 0x400800180000, curr_checkpoint is 0x400800180000
0, 7
Parall_iter 1, Write new metadata at address 0x400800200000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 80, parall_iter is 1, num_threads is 1, last counter is 7, curr_counter is 8
Writing offset is 52080, parall_iter_offset is 2265137152
start_pr_arr is 0x400a1c350000, curr_pr_arr is 0x400a1c350000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 2265124132, start addr is 0x400a1c350000!
Thread ID: 2, savenvm_thread_nd took 2585.794165 ms
Thread ID: 2, set_cpu took 0.075709 ms
Threads took 2585.991695 ms
MSYNC 9060496528 TOOK 20.572082 ms
CAS was successful! new counter is 8, is_distributed is 0
******** checkp_info saved in 0x400800200000, curr_checkpoint is 0x400800200000
1, 8
Parall_iter 0, Write new metadata at address 0x400800180000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 83, parall_iter is 0, num_threads is 1, last counter is 8, curr_counter is 9
Writing offset is 52080, parall_iter_offset is 0
start_pr_arr is 0x400800280000, curr_pr_arr is 0x400800280000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 2265124132, start addr is 0x400800280000!
Thread ID: 1, savenvm_thread_nd took 2605.673115 ms
Thread ID: 1, set_cpu took 0.082878 ms
Threads took 2605.889909 ms
MSYNC 9060496528 TOOK 16.275406 ms
CAS was successful! new counter is 9, is_distributed is 0
******** checkp_info saved in 0x400800180000, curr_checkpoint is 0x400800180000
0, 9
Parall_iter 1, Write new metadata at address 0x400800200000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tidtotal_size: 2265124132, bsize: 2265124132, ratio: 2.0
2265124132 2 False
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 59.514522552490234 ms
CPU copy took 2612.3974323272705 ms
---------------------- [PERF] Single Checkpoint time is 2.692451238632202 sec, average is 2.692448139190674
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 53.917646408081055 ms
CPU copy took 2553.837299346924 ms
---------------------- [PERF] Single Checkpoint time is 2.623192071914673 sec, average is 2.6578184366226196
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 53.87544631958008 ms
CPU copy took 2599.7166633605957 ms
---------------------- [PERF] Single Checkpoint time is 2.66902232170105 sec, average is 2.6690192222595215
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 53.85446548461914 ms
CPU copy took 2565.0970935821533 ms
---------------------- [PERF] Single Checkpoint time is 2.6343820095062256 sec, average is 2.651699185371399
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 53.91502380371094 ms
CPU copy took 2628.862142562866 ms
---------------------- [PERF] Single Checkpoint time is 2.69819974899292 sec, average is 2.6690192222595215
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 53.92122268676758 ms
CPU copy took 2602.6546955108643 ms
---------------------- [PERF] Single Checkpoint time is 2.672004461288452 sec, average is 2.6705108880996704
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 53.91120910644531 ms
CPU copy took 2648.662328720093 ms
---------------------- [PERF] Single Checkpoint time is 2.718010902404785 sec, average is 2.6720025539398193
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 53.878068923950195 ms
CPU copy took 2612.0219230651855 ms
---------------------- [PERF] Single Checkpoint time is 2.6813361644744873 sec, average is 2.676668643951416
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 53.91693115234375 ms
CPU copy took 2627.6066303253174 ms
---------------------- [PERF] Single Checkpoint time is 2.696986436843872 sec, average is 2.6813347339630127
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 53.8945198059082 ms
CPU copy took 2575.7007598876953 ms
---------------------- [PERF] Single Checkpoint time is 2.6298797130584717 sec, average is 2.676668643951416
---- exit
 is 86, parall_iter is 1, num_threads is 1, last counter is 9, curr_counter is 10
Writing offset is 52080, parall_iter_offset is 2265137152
start_pr_arr is 0x400a1c350000, curr_pr_arr is 0x400a1c350000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 2265124132, start addr is 0x400a1c350000!
Thread ID: 2, savenvm_thread_nd took 2552.790981 ms
Thread ID: 2, set_cpu took 0.099325 ms
Threads took 2553.033790 ms
MSYNC 9060496528 TOOK 22.282433 ms
CAS was successful! new counter is 10, is_distributed is 0
******** checkp_info saved in 0x400800200000, curr_checkpoint is 0x400800200000
1, 10
2025-05-24 16:48:57,878 - root - INFO - Training completed
2025-05-24 16:48:57,878 - root - INFO - Training run end: total time taken 28.16 seconds
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
==== PCCHECK END ====
==== RUNNING PCCHECK FOR 2048 WITH fp32 ====
2025-05-24 16:49:01,533 - root - INFO - Experiment args: Namespace(dataset='/capstor/store/cscs/ethz/large-sc/datasets/train_data.parquet', tokenizer_name_or_path='unsloth/Mistral-Nemo-Base-2407-bnb-4bit', sequence_length=2048, batch_size=1, fused_optimizer=False, learning_rate=1e-05, lr_warmup_steps=10, training_steps=10, logging_frequency=5, profile=False, profile_step_start=10, profile_step_end=12, grad_max_norm=1, model_dtype='fp32', compile=False, seed=4, checkpoint_dir='./checkpointing/checkpoints', loss_file='./results/fp32/sl_2048/loss_trace.csv', checkpoint_freq=1, max_async=1, warmup=0, load_checkpoint=False, non_blocking=False)
2025-05-24 16:49:01,535 - root - INFO - Setting up DataLoaders...
2025-05-24 16:49:02,500 - root - INFO - Setting up Model...
Model size: 2281834496, Optimizer size: 4563669284, Total size: 6845503780
BSIZE IS 6845503780
At checkpoint, bsize is 6845503780
2025-05-24 16:49:48,875 - root - INFO - Checkpointing warmup done
2025-05-24 16:49:48,877 - root - INFO - ------------------------------------------------------------Starting training!
2025-05-24 16:49:49,363 - root - INFO - Step: 1 | Loss: 11.91 | Tokens per second: 4394.69 | Training tokens per second (%): 38.77 | MFU (%): 6.08 | TFLOPs: 60.17
2025-05-24 16:49:49,387 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:49:49,388 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:49:49,715 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:49:49,716 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:49:58,309 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:49:58,309 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:50:06,787 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:50:06,787 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:50:15,385 - root - INFO - Step: 5 | Loss: 11.85 | Tokens per second: 315.11 | Training tokens per second (%): 22.83 | MFU (%): 0.44 | TFLOPs: 4.31
2025-05-24 16:50:15,409 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:50:15,410 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:50:23,897 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:50:23,899 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:50:32,519 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:50:32,520 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:50:40,982 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:50:40,984 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:50:49,620 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:50:49,622 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:50:58,241 - root - INFO - Step: 10 | Loss: 11.62 | Tokens per second: 239.07 | Training tokens per second (%): 51.44 | MFU (%): 0.33 | TFLOPs: 3.27
2025-05-24 16:50:58,265 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:50:58,266 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
PR_ADDR_DATA is 0x400f80280000, PR_ADDR is 0x400f80000000, PEER_CHECK_ADDR is 0x400f80080000
--------------- init enqueue: 0
--------------- init enqueue: 1
Call dram.alloc, num_batches is 2, batch_size_floats is 6845503780
------------------------- is_distributed is 0, rank is 0
Parall_iter 0, Write new metadata at address 0x400f80180000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 82, parall_iter is 0, num_threads is 1, last counter is 0, curr_counter is 1
Writing offset is 39792, parall_iter_offset is 0
start_pr_arr is 0x400f80280000, curr_pr_arr is 0x400f80280000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 6845503780, start addr is 0x400f80280000!
Thread ID: 1, savenvm_thread_nd took 8310.845268 ms
Thread ID: 1, set_cpu took 0.106813 ms
Threads took 8311.188970 ms
MSYNC 27382015120 TOOK 14.494305 ms
CAS was successful! new counter is 1, is_distributed is 0
******** checkp_info saved in 0x400f80180000, curr_checkpoint is 0x400f80180000
0, 1
Parall_iter 1, Write new metadata at address 0x400f80200000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 85, parall_iter is 1, num_threads is 1, last counter is 1, curr_counter is 2
Writing offset is 39792, parall_iter_offset is 6845513728
start_pr_arr is 0x4015e0410000, curr_pr_arr is 0x4015e0410000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 6845503780, start addr is 0x4015e0410000!
Thread ID: 2, savenvm_thread_nd took 8176.915411 ms
Thread ID: 2, set_cpu took 0.088894 ms
Threads took 8177.153004 ms
MSYNC 27382015120 TOOK 19.082141 ms
CAS was successful! new counter is 2, is_distributed is 0
******** checkp_info saved in 0x400f80200000, curr_checkpoint is 0x400f80200000
1, 2
Parall_iter 0, Write new metadata at address 0x400f80180000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 108, parall_iter is 0, num_threads is 1, last counter is 2, curr_counter is 3
Writing offset is 39792, parall_iter_offset is 0
start_pr_arr is 0x400f80280000, curr_pr_arr is 0x400f80280000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 6845503780, start addr is 0x400f80280000!
Thread ID: 1, savenvm_thread_nd took 8317.437079 ms
Thread ID: 1, set_cpu took 0.080222 ms
Threads took 8317.665456 ms
MSYNC 27382015120 TOOK 26.697570 ms
CAS was successful! new counter is 3, is_distributed is 0
******** checkp_info saved in 0x400f80180000, curr_checkpoint is 0x400f80180000
0, 3
Parall_iter 1, Write new metadata at address 0x400f80200000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 23, parall_iter is 1, num_threads is 1, last counter is 3, curr_counter is 4
Writing offset is 39792, parall_iter_offset is 6845513728
start_pr_arr is 0x4015e0410000, curr_pr_arr is 0x4015e0410000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 6845503780, start addr is 0x4015e0410000!
Thread ID: 2, savenvm_thread_nd took 8195.789622 ms
Thread ID: 2, set_cpu took 0.078430 ms
Threads took 8196.016431 ms
MSYNC 27382015120 TOOK 16.208943 ms
CAS was successful! new counter is 4, is_distributed is 0
******** checkp_info saved in 0x400f80200000, curr_checkpoint is 0x400f80200000
1, 4
Parall_iter 0, Write new metadata at address 0x400f80180000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 26, parall_iter is 0, num_threads is 1, last counter is 4, curr_counter is 5
Writing offset is 39792, parall_iter_offset is 0
start_pr_arr is 0x400f80280000, curr_pr_arr is 0x400f80280000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 6845503780, start addr is 0x400f80280000!
Thread ID: 1, savenvm_thread_nd took 8318.039813 ms
Thread ID: 1, set_cpu took 0.072446 ms
Threads took 8318.259679 ms
MSYNC 27382015120 TOOK 25.963831 ms
CAS was successful! new counter is 5, is_distributed is 0
******** checkp_info saved in 0x400f80180000, curr_checkpoint is 0x400f80180000
0, 5
Parall_iter 1, Write new metadata at address 0x400f80200000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 54, parall_iter is 1, num_threads is 1, last counter is 5, curr_counter is 6
Writing offset is 39792, parall_iter_offset is 6845513728
start_pr_arr is 0x4015e0410000, curr_pr_arr is 0x4015e0410000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 6845503780, start addr is 0x4015e0410000!
Thread ID: 2, savenvm_thread_nd took 8168.479782 ms
Thread ID: 2, set_cpu took 0.097117 ms
Threads took 8168.726911 ms
MSYNC 27382015120 TOOK 18.032890 ms
CAS was successful! new counter is 6, is_distributed is 0
******** checkp_info saved in 0x400f80200000, curr_checkpoint is 0x400f80200000
1, 6
Parall_iter 0, Write new metadata at address 0x400f80180000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 98, parall_iter is 0, num_threads is 1, last counter is 6, curr_counter is 7
Writing offset is 39792, parall_iter_offset is 0
start_pr_arr is 0x400f80280000, curr_pr_arr is 0x400f80280000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 6845503780, start addr is 0x400f80280000!
Thread ID: 1, savenvm_thread_nd took 8342.534857 ms
Thread ID: 1, set_cpu took 0.074398 ms
Threads took 8342.745346 ms
MSYNC 27382015120 TOOK 18.323218 ms
CAS was successful! new counter is 7, is_distributed is 0
******** checkp_info saved in 0x400f80180000, curr_checkpoint is 0x400f80180000
0, 7
Parall_iter 1, Write new metadata at address 0x400f80200000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 121, parall_iter is 1, num_threads is 1, last counter is 7, curr_counter is 8
Writing offset is 39792, parall_iter_offset is 6845513728
start_pr_arr is 0x4015e0410000, curr_pr_arr is 0x4015e0410000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 6845503780, start addr is 0x4015e0410000!
Thread ID: 2, savenvm_thread_nd took 8328.527547 ms
Thread ID: 2, set_cpu took 0.082014 ms
Threads took 8328.741206 ms
MSYNC 27382015120 TOOK 38.053274 ms
CAS was successful! new counter is 8, is_distributed is 0
******** checkp_info saved in 0x400f80200000, curr_checkpoint is 0x400f80200000
1, 8
Parall_iter 0, Write new metadata at address 0x400f80180000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 124, parall_iter is 0, num_threads is 1, last counter is 8, curr_counter is 9
Writing offset is 39792, parall_iter_offset is 0
start_pr_arr is 0x400f80280000, curr_pr_arr is 0x400f80280000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 6845503780, start addr is 0x400f80280000!
Thread ID: 1, savenvm_thread_nd took 8429.639012 ms
Thread ID: 1, set_cpu took 0.075517 ms
Threads took 8429.879581 ms
MSYNC 27382015120 TOOK 20.245115 ms
CAS was successful! new counter is 9, is_distributed is 0
******** checkp_info saved in 0x400f80180000, curr_checkpoint is 0x400f80180000
0, 9
Parall_iter 1, Write new metadata at address 0x400f80200000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savtotal_size: 6845503780, bsize: 6845503780, ratio: 2.0
6845503780 2 False
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 242.2778606414795 ms
CPU copy took 8331.181526184082 ms
---------------------- [PERF] Single Checkpoint time is 8.59412670135498 sec, average is 8.594123601913452
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 240.32092094421387 ms
CPU copy took 8201.691627502441 ms
---------------------- [PERF] Single Checkpoint time is 8.462522268295288 sec, average is 8.528321385383606
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 240.21291732788086 ms
CPU copy took 8349.814414978027 ms
---------------------- [PERF] Single Checkpoint time is 8.610552310943604 sec, average is 8.594123601913452
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 240.18311500549316 ms
CPU copy took 8217.679500579834 ms
---------------------- [PERF] Single Checkpoint time is 8.473361730575562 sec, average is 8.53374195098877
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 240.2207851409912 ms
CPU copy took 8349.682807922363 ms
---------------------- [PERF] Single Checkpoint time is 8.605374336242676 sec, average is 8.594123601913452
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 240.2327060699463 ms
CPU copy took 8192.232847213745 ms
---------------------- [PERF] Single Checkpoint time is 8.447931289672852 sec, average is 8.53374195098877
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 240.64016342163086 ms
CPU copy took 8366.520166397095 ms
---------------------- [PERF] Single Checkpoint time is 8.622664213180542 sec, average is 8.594123601913452
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 240.17906188964844 ms
CPU copy took 8372.231006622314 ms
---------------------- [PERF] Single Checkpoint time is 8.62789797782898 sec, average is 8.599747657775879
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 240.3542995452881 ms
CPU copy took 8455.619096755981 ms
---------------------- [PERF] Single Checkpoint time is 8.716508150100708 sec, average is 8.605371713638306
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 240.06175994873047 ms
CPU copy took 8392.135381698608 ms
---------------------- [PERF] Single Checkpoint time is 8.632561922073364 sec, average is 8.607960939407349
---- exit
envmNew, tid is 22, parall_iter is 1, num_threads is 1, last counter is 9, curr_counter is 10
Writing offset is 39792, parall_iter_offset is 6845513728
start_pr_arr is 0x4015e0410000, curr_pr_arr is 0x4015e0410000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 6845503780, start addr is 0x4015e0410000!
Thread ID: 2, savenvm_thread_nd took 8372.641641 ms
Thread ID: 2, set_cpu took 0.076606 ms
Threads took 8372.849795 ms
MSYNC 27382015120 TOOK 18.830819 ms
CAS was successful! new counter is 10, is_distributed is 0
******** checkp_info saved in 0x400f80200000, curr_checkpoint is 0x400f80200000
1, 10
2025-05-24 16:51:17,052 - root - INFO - Training completed
2025-05-24 16:51:17,052 - root - INFO - Training run end: total time taken 88.18 seconds
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
Setting optimizer state...
******************** CALL SAVE ********************
==== PCCHECK END ====
==== RUNNING PCCHECK FOR 1024 WITH bf16 ====
2025-05-24 16:51:20,760 - root - INFO - Experiment args: Namespace(dataset='/capstor/store/cscs/ethz/large-sc/datasets/train_data.parquet', tokenizer_name_or_path='unsloth/Mistral-Nemo-Base-2407-bnb-4bit', sequence_length=1024, batch_size=1, fused_optimizer=False, learning_rate=1e-05, lr_warmup_steps=10, training_steps=10, logging_frequency=5, profile=False, profile_step_start=10, profile_step_end=12, grad_max_norm=1, model_dtype='bf16', compile=False, seed=4, checkpoint_dir='./checkpointing/checkpoints', loss_file='./results/bf16/sl_1024/loss_trace.csv', checkpoint_freq=1, max_async=1, warmup=0, load_checkpoint=False, non_blocking=False)
2025-05-24 16:51:20,762 - root - INFO - Setting up DataLoaders...
2025-05-24 16:51:21,606 - root - INFO - Setting up Model...
Model size: 755041280, Optimizer size: 1510082852, Total size: 2265124132
BSIZE IS 2265124132
At checkpoint, bsize is 2265124132
2025-05-24 16:52:01,149 - root - INFO - Checkpointing warmup done
2025-05-24 16:52:01,151 - root - INFO - ------------------------------------------------------------Starting training!
2025-05-24 16:52:01,416 - root - INFO - Step: 1 | Loss: 11.92 | Tokens per second: 3882.97 | Training tokens per second (%): 77.54 | MFU (%): 1.62 | TFLOPs: 16.03
2025-05-24 16:52:01,449 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:52:01,450 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:52:01,598 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:52:01,599 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:52:04,260 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:52:04,261 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:52:06,921 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:52:06,922 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:52:09,625 - root - INFO - Step: 5 | Loss: 11.92 | Tokens per second: 499.03 | Training tokens per second (%): 40.14 | MFU (%): 0.21 | TFLOPs: 2.06
2025-05-24 16:52:09,664 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:52:09,666 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:52:12,358 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:52:12,359 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:52:15,099 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:52:15,100 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:52:17,804 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:52:17,806 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:52:20,550 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:52:20,551 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:52:23,188 - root - INFO - Step: 10 | Loss: 11.93 | Tokens per second: 377.56 | Training tokens per second (%): 83.77 | MFU (%): 0.16 | TFLOPs: 1.56
2025-05-24 16:52:23,225 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:52:23,226 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
PR_ADDR_DATA is 0x400800280000, PR_ADDR is 0x400800000000, PEER_CHECK_ADDR is 0x400800080000
--------------- init enqueue: 0
--------------- init enqueue: 1
Call dram.alloc, num_batches is 2, batch_size_floats is 2265124132
------------------------- is_distributed is 0, rank is 0
Parall_iter 0, Write new metadata at address 0x400800180000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 26, parall_iter is 0, num_threads is 1, last counter is 0, curr_counter is 1
Writing offset is 52080, parall_iter_offset is 0
start_pr_arr is 0x400800280000, curr_pr_arr is 0x400800280000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 2265124132, start addr is 0x400800280000!
Thread ID: 1, savenvm_thread_nd took 2576.578931 ms
Thread ID: 1, set_cpu took 0.092221 ms
Threads took 2576.918505 ms
MSYNC 9060496528 TOOK 16.516260 ms
CAS was successful! new counter is 1, is_distributed is 0
******** checkp_info saved in 0x400800180000, curr_checkpoint is 0x400800180000
0, 1
Parall_iter 1, Write new metadata at address 0x400800200000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 29, parall_iter is 1, num_threads is 1, last counter is 1, curr_counter is 2
Writing offset is 52080, parall_iter_offset is 2265137152
start_pr_arr is 0x400a1c350000, curr_pr_arr is 0x400a1c350000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 2265124132, start addr is 0x400a1c350000!
Thread ID: 2, savenvm_thread_nd took 2560.449474 ms
Thread ID: 2, set_cpu took 0.084862 ms
Threads took 2560.635357 ms
MSYNC 9060496528 TOOK 16.911162 ms
CAS was successful! new counter is 2, is_distributed is 0
******** checkp_info saved in 0x400800200000, curr_checkpoint is 0x400800200000
1, 2
Parall_iter 0, Write new metadata at address 0x400800180000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 32, parall_iter is 0, num_threads is 1, last counter is 2, curr_counter is 3
Writing offset is 52080, parall_iter_offset is 0
start_pr_arr is 0x400800280000, curr_pr_arr is 0x400800280000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 2265124132, start addr is 0x400800280000!
Thread ID: 1, savenvm_thread_nd took 2633.571659 ms
Thread ID: 1, set_cpu took 0.076733 ms
Threads took 2633.747269 ms
MSYNC 9060496528 TOOK 18.320913 ms
CAS was successful! new counter is 3, is_distributed is 0
******** checkp_info saved in 0x400800180000, curr_checkpoint is 0x400800180000
0, 3
Parall_iter 1, Write new metadata at address 0x400800200000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 35, parall_iter is 1, num_threads is 1, last counter is 3, curr_counter is 4
Writing offset is 52080, parall_iter_offset is 2265137152
start_pr_arr is 0x400a1c350000, curr_pr_arr is 0x400a1c350000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 2265124132, start addr is 0x400a1c350000!
Thread ID: 2, savenvm_thread_nd took 2584.776808 ms
Thread ID: 2, set_cpu took 0.088925 ms
Threads took 2584.974850 ms
MSYNC 9060496528 TOOK 19.657418 ms
CAS was successful! new counter is 4, is_distributed is 0
******** checkp_info saved in 0x400800200000, curr_checkpoint is 0x400800200000
1, 4
Parall_iter 0, Write new metadata at address 0x400800180000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 55, parall_iter is 0, num_threads is 1, last counter is 4, curr_counter is 5
Writing offset is 52080, parall_iter_offset is 0
start_pr_arr is 0x400800280000, curr_pr_arr is 0x400800280000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 2265124132, start addr is 0x400800280000!
Thread ID: 1, savenvm_thread_nd took 2629.654556 ms
Thread ID: 1, set_cpu took 0.088093 ms
Threads took 2629.853110 ms
MSYNC 9060496528 TOOK 19.849860 ms
CAS was successful! new counter is 5, is_distributed is 0
******** checkp_info saved in 0x400800180000, curr_checkpoint is 0x400800180000
0, 5
Parall_iter 1, Write new metadata at address 0x400800200000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 81, parall_iter is 1, num_threads is 1, last counter is 5, curr_counter is 6
Writing offset is 52080, parall_iter_offset is 2265137152
start_pr_arr is 0x400a1c350000, curr_pr_arr is 0x400a1c350000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 2265124132, start addr is 0x400a1c350000!
Thread ID: 2, savenvm_thread_nd took 2594.492912 ms
Thread ID: 2, set_cpu took 0.074910 ms
Threads took 2594.670859 ms
MSYNC 9060496528 TOOK 20.203354 ms
CAS was successful! new counter is 6, is_distributed is 0
******** checkp_info saved in 0x400800200000, curr_checkpoint is 0x400800200000
1, 6
Parall_iter 0, Write new metadata at address 0x400800180000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 84, parall_iter is 0, num_threads is 1, last counter is 6, curr_counter is 7
Writing offset is 52080, parall_iter_offset is 0
start_pr_arr is 0x400800280000, curr_pr_arr is 0x400800280000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 2265124132, start addr is 0x400800280000!
Thread ID: 1, savenvm_thread_nd took 2625.317624 ms
Thread ID: 1, set_cpu took 0.061055 ms
Threads took 2625.484820 ms
MSYNC 9060496528 TOOK 29.788743 ms
CAS was successful! new counter is 7, is_distributed is 0
******** checkp_info saved in 0x400800180000, curr_checkpoint is 0x400800180000
0, 7
Parall_iter 1, Write new metadata at address 0x400800200000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 87, parall_iter is 1, num_threads is 1, last counter is 7, curr_counter is 8
Writing offset is 52080, parall_iter_offset is 2265137152
start_pr_arr is 0x400a1c350000, curr_pr_arr is 0x400a1c350000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 2265124132, start addr is 0x400a1c350000!
Thread ID: 2, savenvm_thread_nd took 2557.180577 ms
Thread ID: 2, set_cpu took 0.086878 ms
Threads took 2557.386714 ms
MSYNC 9060496528 TOOK 28.071609 ms
CAS was successful! new counter is 8, is_distributed is 0
******** checkp_info saved in 0x400800200000, curr_checkpoint is 0x400800200000
1, 8
Parall_iter 0, Write new metadata at address 0x400800180000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tid is 90, parall_iter is 0, num_threads is 1, last counter is 8, curr_counter is 9
Writing offset is 52080, parall_iter_offset is 0
start_pr_arr is 0x400800280000, curr_pr_arr is 0x400800280000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 2265124132, start addr is 0x400800280000!
Thread ID: 1, savenvm_thread_nd took 2619.103052 ms
Thread ID: 1, set_cpu took 0.085949 ms
Threads took 2619.293478 ms
MSYNC 9060496528 TOOK 20.186843 ms
CAS was successful! new counter is 9, is_distributed is 0
******** checkp_info saved in 0x400800180000, curr_checkpoint is 0x400800180000
0, 9
Parall_iter 1, Write new metadata at address 0x400800200000
------------------------- savenvmNew, is_distributed is 0, total_size is 2265124132
At savenvmNew, tidtotal_size: 2265124132, bsize: 2265124132, ratio: 2.0
2265124132 2 False
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 59.32474136352539 ms
CPU copy took 2598.945379257202 ms
---------------------- [PERF] Single Checkpoint time is 2.6838927268981934 sec, average is 2.683889150619507
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 53.893089294433594 ms
CPU copy took 2582.9811096191406 ms
---------------------- [PERF] Single Checkpoint time is 2.652285099029541 sec, average is 2.6680859327316284
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 53.874969482421875 ms
CPU copy took 2657.4645042419434 ms
---------------------- [PERF] Single Checkpoint time is 2.7267415523529053 sec, average is 2.683889150619507
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 53.832292556762695 ms
CPU copy took 2610.041379928589 ms
---------------------- [PERF] Single Checkpoint time is 2.6793112754821777 sec, average is 2.681599497795105
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 53.893327713012695 ms
CPU copy took 2655.1480293273926 ms
---------------------- [PERF] Single Checkpoint time is 2.7244629859924316 sec, average is 2.683889150619507
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 53.91097068786621 ms
CPU copy took 2620.311498641968 ms
---------------------- [PERF] Single Checkpoint time is 2.6896519660949707 sec, average is 2.6867698431015015
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 53.89213562011719 ms
CPU copy took 2660.749673843384 ms
---------------------- [PERF] Single Checkpoint time is 2.7300755977630615 sec, average is 2.689650535583496
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 53.91335487365723 ms
CPU copy took 2590.9197330474854 ms
---------------------- [PERF] Single Checkpoint time is 2.660276174545288 sec, average is 2.6867698431015015
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 53.90119552612305 ms
CPU copy took 2644.9313163757324 ms
---------------------- [PERF] Single Checkpoint time is 2.719303607940674 sec, average is 2.689650535583496
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 53.90739440917969 ms
CPU copy took 2617.6652908325195 ms
---------------------- [PERF] Single Checkpoint time is 2.6717870235443115 sec, average is 2.6867698431015015
---- exit
 is 114, parall_iter is 1, num_threads is 1, last counter is 9, curr_counter is 10
Writing offset is 52080, parall_iter_offset is 2265137152
start_pr_arr is 0x400a1c350000, curr_pr_arr is 0x400a1c350000, batch_size is 2265124132, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 2265124132
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 2265124132, start addr is 0x400a1c350000!
Thread ID: 2, savenvm_thread_nd took 2596.590931 ms
Thread ID: 2, set_cpu took 0.075166 ms
Threads took 2596.765966 ms
MSYNC 9060496528 TOOK 20.518034 ms
CAS was successful! new counter is 10, is_distributed is 0
******** checkp_info saved in 0x400800200000, curr_checkpoint is 0x400800200000
1, 10
2025-05-24 16:52:29,501 - root - INFO - Training completed
2025-05-24 16:52:29,501 - root - INFO - Training run end: total time taken 28.35 seconds
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
==== PCCHECK END ====
==== RUNNING PCCHECK FOR 2048 WITH bf16 ====
2025-05-24 16:52:33,474 - root - INFO - Experiment args: Namespace(dataset='/capstor/store/cscs/ethz/large-sc/datasets/train_data.parquet', tokenizer_name_or_path='unsloth/Mistral-Nemo-Base-2407-bnb-4bit', sequence_length=2048, batch_size=1, fused_optimizer=False, learning_rate=1e-05, lr_warmup_steps=10, training_steps=10, logging_frequency=5, profile=False, profile_step_start=10, profile_step_end=12, grad_max_norm=1, model_dtype='bf16', compile=False, seed=4, checkpoint_dir='./checkpointing/checkpoints', loss_file='./results/bf16/sl_2048/loss_trace.csv', checkpoint_freq=1, max_async=1, warmup=0, load_checkpoint=False, non_blocking=False)
2025-05-24 16:52:33,476 - root - INFO - Setting up DataLoaders...
2025-05-24 16:52:34,335 - root - INFO - Setting up Model...
Model size: 2281834496, Optimizer size: 4563669284, Total size: 6845503780
BSIZE IS 6845503780
At checkpoint, bsize is 6845503780
2025-05-24 16:53:25,409 - root - INFO - Checkpointing warmup done
2025-05-24 16:53:25,410 - root - INFO - ------------------------------------------------------------Starting training!
2025-05-24 16:53:25,744 - root - INFO - Step: 1 | Loss: 11.92 | Tokens per second: 6176.44 | Training tokens per second (%): 38.77 | MFU (%): 8.55 | TFLOPs: 84.56
2025-05-24 16:53:25,800 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:53:25,800 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:53:26,144 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:53:26,145 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:53:35,090 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:53:35,091 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:53:43,955 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:53:43,957 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:53:52,835 - root - INFO - Step: 5 | Loss: 11.91 | Tokens per second: 302.44 | Training tokens per second (%): 22.83 | MFU (%): 0.42 | TFLOPs: 4.14
2025-05-24 16:53:52,894 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:53:52,896 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:54:01,795 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:54:01,796 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:54:10,749 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:54:10,751 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:54:19,460 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:54:19,461 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:54:28,357 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:54:28,358 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
2025-05-24 16:54:36,944 - root - INFO - Step: 10 | Loss: 11.87 | Tokens per second: 232.16 | Training tokens per second (%): 51.44 | MFU (%): 0.32 | TFLOPs: 3.18
2025-05-24 16:54:37,004 - root - INFO - Random states checkpoint saved to ./checkpointing/checkpoints/rng_states.pt
2025-05-24 16:54:37,005 - root - INFO - Checkpoint saved to ./checkpointing/checkpoints
PR_ADDR_DATA is 0x400e40280000, PR_ADDR is 0x400e40000000, PEER_CHECK_ADDR is 0x400e40080000
--------------- init enqueue: 0
--------------- init enqueue: 1
Call dram.alloc, num_batches is 2, batch_size_floats is 6845503780
------------------------- is_distributed is 0, rank is 0
Parall_iter 0, Write new metadata at address 0x400e40180000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 118, parall_iter is 0, num_threads is 1, last counter is 0, curr_counter is 1
Writing offset is 39792, parall_iter_offset is 0
start_pr_arr is 0x400e40280000, curr_pr_arr is 0x400e40280000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 6845503780, start addr is 0x400e40280000!
Thread ID: 1, savenvm_thread_nd took 8656.793823 ms
Thread ID: 1, set_cpu took 0.111261 ms
Threads took 8657.159765 ms
MSYNC 27382015120 TOOK 15.825593 ms
CAS was successful! new counter is 1, is_distributed is 0
******** checkp_info saved in 0x400e40180000, curr_checkpoint is 0x400e40180000
0, 1
Parall_iter 1, Write new metadata at address 0x400e40200000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 122, parall_iter is 1, num_threads is 1, last counter is 1, curr_counter is 2
Writing offset is 39792, parall_iter_offset is 6845513728
start_pr_arr is 0x4014a0410000, curr_pr_arr is 0x4014a0410000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 6845503780, start addr is 0x4014a0410000!
Thread ID: 2, savenvm_thread_nd took 8562.165156 ms
Thread ID: 2, set_cpu took 0.095709 ms
Threads took 8562.390462 ms
MSYNC 27382015120 TOOK 21.539668 ms
CAS was successful! new counter is 2, is_distributed is 0
******** checkp_info saved in 0x400e40200000, curr_checkpoint is 0x400e40200000
1, 2
Parall_iter 0, Write new metadata at address 0x400e40180000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 40, parall_iter is 0, num_threads is 1, last counter is 2, curr_counter is 3
Writing offset is 39792, parall_iter_offset is 0
start_pr_arr is 0x400e40280000, curr_pr_arr is 0x400e40280000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 6845503780, start addr is 0x400e40280000!
Thread ID: 1, savenvm_thread_nd took 8627.926943 ms
Thread ID: 1, set_cpu took 0.091230 ms
Threads took 8628.138297 ms
MSYNC 27382015120 TOOK 22.650996 ms
CAS was successful! new counter is 3, is_distributed is 0
******** checkp_info saved in 0x400e40180000, curr_checkpoint is 0x400e40180000
0, 3
Parall_iter 1, Write new metadata at address 0x400e40200000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 61, parall_iter is 1, num_threads is 1, last counter is 3, curr_counter is 4
Writing offset is 39792, parall_iter_offset is 6845513728
start_pr_arr is 0x4014a0410000, curr_pr_arr is 0x4014a0410000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 6845503780, start addr is 0x4014a0410000!
Thread ID: 2, savenvm_thread_nd took 8604.525982 ms
Thread ID: 2, set_cpu took 0.087550 ms
Threads took 8604.769816 ms
MSYNC 27382015120 TOOK 14.463103 ms
CAS was successful! new counter is 4, is_distributed is 0
******** checkp_info saved in 0x400e40200000, curr_checkpoint is 0x400e40200000
1, 4
Parall_iter 0, Write new metadata at address 0x400e40180000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 83, parall_iter is 0, num_threads is 1, last counter is 4, curr_counter is 5
Writing offset is 39792, parall_iter_offset is 0
start_pr_arr is 0x400e40280000, curr_pr_arr is 0x400e40280000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 6845503780, start addr is 0x400e40280000!
Thread ID: 1, savenvm_thread_nd took 8659.762600 ms
Thread ID: 1, set_cpu took 0.072350 ms
Threads took 8659.969346 ms
MSYNC 27382015120 TOOK 18.218932 ms
CAS was successful! new counter is 5, is_distributed is 0
******** checkp_info saved in 0x400e40180000, curr_checkpoint is 0x400e40180000
0, 5
Parall_iter 1, Write new metadata at address 0x400e40200000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 110, parall_iter is 1, num_threads is 1, last counter is 5, curr_counter is 6
Writing offset is 39792, parall_iter_offset is 6845513728
start_pr_arr is 0x4014a0410000, curr_pr_arr is 0x4014a0410000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 6845503780, start addr is 0x4014a0410000!
Thread ID: 2, savenvm_thread_nd took 8414.953264 ms
Thread ID: 2, set_cpu took 0.074046 ms
Threads took 8415.173641 ms
MSYNC 27382015120 TOOK 14.404385 ms
CAS was successful! new counter is 6, is_distributed is 0
******** checkp_info saved in 0x400e40200000, curr_checkpoint is 0x400e40200000
1, 6
Parall_iter 0, Write new metadata at address 0x400e40180000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 26, parall_iter is 0, num_threads is 1, last counter is 6, curr_counter is 7
Writing offset is 39792, parall_iter_offset is 0
start_pr_arr is 0x400e40280000, curr_pr_arr is 0x400e40280000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 6845503780, start addr is 0x400e40280000!
Thread ID: 1, savenvm_thread_nd took 8600.103869 ms
Thread ID: 1, set_cpu took 0.083198 ms
Threads took 8600.307351 ms
MSYNC 27382015120 TOOK 18.346128 ms
CAS was successful! new counter is 7, is_distributed is 0
******** checkp_info saved in 0x400e40180000, curr_checkpoint is 0x400e40180000
0, 7
Parall_iter 1, Write new metadata at address 0x400e40200000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 53, parall_iter is 1, num_threads is 1, last counter is 7, curr_counter is 8
Writing offset is 39792, parall_iter_offset is 6845513728
start_pr_arr is 0x4014a0410000, curr_pr_arr is 0x4014a0410000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 6845503780, start addr is 0x4014a0410000!
Thread ID: 2, savenvm_thread_nd took 8354.229252 ms
Thread ID: 2, set_cpu took 0.086270 ms
Threads took 8354.445950 ms
MSYNC 27382015120 TOOK 14.526045 ms
CAS was successful! new counter is 8, is_distributed is 0
******** checkp_info saved in 0x400e40200000, curr_checkpoint is 0x400e40200000
1, 8
Parall_iter 0, Write new metadata at address 0x400e40180000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savenvmNew, tid is 57, parall_iter is 0, num_threads is 1, last counter is 8, curr_counter is 9
Writing offset is 39792, parall_iter_offset is 0
start_pr_arr is 0x400e40280000, curr_pr_arr is 0x400e40280000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 1, CPU USE: 11
At savenvm_thread_nd id is 1, sz is 6845503780, start addr is 0x400e40280000!
Thread ID: 1, savenvm_thread_nd took 8569.973889 ms
Thread ID: 1, set_cpu took 0.078878 ms
Threads took 8570.172508 ms
MSYNC 27382015120 TOOK 16.934744 ms
CAS was successful! new counter is 9, is_distributed is 0
******** checkp_info saved in 0x400e40180000, curr_checkpoint is 0x400e40180000
0, 9
Parall_iter 1, Write new metadata at address 0x400e40200000
------------------------- savenvmNew, is_distributed is 0, total_size is 6845503780
At savtotal_size: 6845503780, bsize: 6845503780, ratio: 2.0
6845503780 2 False
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 247.82824516296387 ms
CPU copy took 8678.508043289185 ms
---------------------- [PERF] Single Checkpoint time is 8.946999311447144 sec, average is 8.946996450424194
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 245.23448944091797 ms
CPU copy took 8589.395523071289 ms
---------------------- [PERF] Single Checkpoint time is 8.850107192993164 sec, average is 8.898549795150757
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 245.22709846496582 ms
CPU copy took 8656.24713897705 ms
---------------------- [PERF] Single Checkpoint time is 8.921992301940918 sec, average is 8.921990633010864
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 245.1324462890625 ms
CPU copy took 8624.704599380493 ms
---------------------- [PERF] Single Checkpoint time is 8.885362148284912 sec, average is 8.90367579460144
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 245.25189399719238 ms
CPU copy took 8683.642148971558 ms
---------------------- [PERF] Single Checkpoint time is 8.944380760192871 sec, average is 8.921990633010864
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 245.78213691711426 ms
CPU copy took 8435.024499893188 ms
---------------------- [PERF] Single Checkpoint time is 8.696270942687988 sec, average is 8.90367579460144
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 245.52011489868164 ms
CPU copy took 8624.113082885742 ms
---------------------- [PERF] Single Checkpoint time is 8.885077953338623 sec, average is 8.885360956192017
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 245.19920349121094 ms
CPU copy took 8374.427556991577 ms
---------------------- [PERF] Single Checkpoint time is 8.635109186172485 sec, average is 8.885218501091003
Save checkpoint with process 0
************** New checkpoint at position 0
GPU copy took 245.23305892944336 ms
CPU copy took 8592.554092407227 ms
---------------------- [PERF] Single Checkpoint time is 8.85326075553894 sec, average is 8.88507604598999
Save checkpoint with process 0
************** New checkpoint at position 1
GPU copy took 244.89164352416992 ms
CPU copy took 8422.189712524414 ms
---------------------- [PERF] Single Checkpoint time is 8.66738486289978 sec, average is 8.86916720867157
---- exit
envmNew, tid is 101, parall_iter is 1, num_threads is 1, last counter is 9, curr_counter is 10
Writing offset is 39792, parall_iter_offset is 6845513728
start_pr_arr is 0x4014a0410000, curr_pr_arr is 0x4014a0410000, batch_size is 6845503780, batch_num is 1
Save checkpoint - create threads!
size_for_thread_i is 6845503780
CPU: 2, CPU USE: 12
At savenvm_thread_nd id is 2, sz is 6845503780, start addr is 0x4014a0410000!
Thread ID: 2, savenvm_thread_nd took 8399.740298 ms
Thread ID: 2, set_cpu took 0.062718 ms
Threads took 8399.928004 ms
MSYNC 27382015120 TOOK 21.838571 ms
CAS was successful! new counter is 10, is_distributed is 0
******** checkp_info saved in 0x400e40200000, curr_checkpoint is 0x400e40200000
1, 10
2025-05-24 16:54:55,950 - root - INFO - Training completed
2025-05-24 16:54:55,950 - root - INFO - Training run end: total time taken 90.54 seconds
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
Setting optimizer state...
Setting model state...
******************** CALL SAVE ********************
==== PCCHECK END ====
Benchmarking complete.
